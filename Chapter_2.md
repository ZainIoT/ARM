# 2 ARM微处理器概述与编程模型

## 2.1 ARM微处理器概述

**ARM（advanced RISC machines）** 有三种含义：

1. 它是一个**公司名称**
2. 是一类微处理器的**通称**
3. 是一种**技术的名称**

### 2.1.1 ARM微处理器的特点

采用RSIC架构的ARM微处理器有如下特点：

1. 体积小、低功耗、低成本、高性能；
2. 支持Thumb（16位）/ARM（32位）双指令集，能很好的兼容8位/16位器件；
3. 大量使用寄存器，**指令执行速度快**；
4. 大多数数据操作都在寄存器中完成；
5. 寻址方式灵活简单，执行效率高；
6. 指令长度固定。

## 2.2 ARM微处理器结构

### 2.2.2 ARM微处理器寄存器结构

ARM处理器共有 **37** 个寄存器，被分为若干个组（BANK）

* **31** 个**通用寄存器**；（包括程序计数器（PC指针），均为32位寄存器）
* **6** 个**状态寄存器**。（用以标识CPU的工作状态及程序的运行状态，均为32位寄存器）

## 2.3 ARM微处理器的工作状态

> ARM微处理器的**工作状态**有**两种**，并可在两种状态之间切换
> * **ARM状态**    此时处理器执行**32**位的**字对齐**的ARM指令
> * **Thumb状态**  此时处理器执行**16**位的**半字对齐**的Thumb指令

!> 注意：ARM处理器在开始执行代码时，应处于ARM状态！！！

* 进入 Thumb 状态：
  当操作数寄存器的状态位（位0）为1时，可采用执行 BX 指令的方法，使微处理器从ARM状态切换到Thumb状态。
  当处理器处于Thumb状态时发生异常，则异常处理返回时，自动切换到Thumb状态。

* 进入 ARM 状态：
  当操作数寄存器的状态位（位0）为0时，可采用执行 BX 指令的方法，使微处理器从Thumb状态切换到ARM状态。
  在处理器进行异常处理时，把PC指针放入异常模式链接寄存器中，并从异常向量地址开始执行程序，也可以使处理器切换到ARM状态。

## 2.4 ARM体系结构的存储器格式

> ARM体系结构将存储器看作是从零地址开始的字节的线性组合。从零字节到三字节放置第一个存储的字数据，从第四个字节到第七个字节放置第二个存储的字数据，依次排列。作为32位的微处理器,ARM体系结构所支持的最大录址空间为4GB($2^{32}$字节)。

ARM体系结构可以用**两种方法存储字数据**，称之为**大端格式**和**小端格式**具体说明如下：

1.**大端格式**：
字数据的*高字节*存储在*低地址*中，而字数据的*低字节*则存放在*高地址*；

2.**小端格式**：（与大端格式相反）
字数据的*高字节*存储在*高地址*中，而字数据的*低字节*则存放在*低地址*；

**下面我将使用一个详细的示例来解释两种存储格式**：
32位的整数0x12345678存放到一个整型变量（int）中，这个整型变量采用大端或者小端格式在内存中的存储由下表所示。使用Byte_3表示一个32位数据的最高字节，使用Byte_0表示一个32位数据最低字节。

|地址|大端模式|小端模式|
|:--:|:--:|:--:|
0x00（低地址）|12（Byte_3）|78（Byte_0）
0x01 ↓|34（Byte_2）|56（Byte_1）
0x02 ↓|56（Byte_1）|34（Byte_2）
0x03（高地址）|78（Byte_0）|12（Byte_3）

## 2.5 处理器模式

ARM微处理器支持7中运行模式：
1. usr → **用户模式**：ARM处理器正常的程序执行状态；
2. fiq → **快速中断模式**：用于高速数据传输或通道处理；
3. irq → **外部中断模式**：用于通用的中断处理；
4. svc → **管理模式**：操作系统使用的保护模式；
5. abt → **数据访问终止模式**：当数据或指令预取终止时进入该模式，可用于虚拟内存及存储保护；
6. sys → **系统模式**：运行具有特权的操作系统任务；
7. und → **未定义指令终止模式**：当未定义的指令执行时进入该模式，可用于支持硬件协处理器的软件仿真。

<div id="diagram">Diagram will be placed here</div>
